groups:
- name: node data disk alert
  rules:
  - alert: host disk_data_used alert
    annotations:
      disk_data_path: ${DISK_DATA_PATH}
      consignee: ${EMAIL_ADDRESS}
      description: 主机 {{ $labels.instance }} 数据分区使用率为 {{ $value | humanize }}%, 大于
        阈值 90%
      summary: disk_data_used (instance {{ $labels.instance }})
    expr: max((node_filesystem_size_bytes{env="${ENV}",mountpoint="${DISK_DATA_PATH}"}-node_filesystem_free_bytes{env="${ENV}",mountpoint="${DISK_DATA_PATH}"})
      *100/(node_filesystem_avail_bytes{env="${ENV}",mountpoint="${DISK_DATA_PATH}"}+(node_filesystem_size_bytes{env="${ENV}",mountpoint="${DISK_DATA_PATH}"}-node_filesystem_free_bytes{env="${ENV}",mountpoint="${DISK_DATA_PATH}"})))by(instance,env)
      >= 90
    for: 1m
    labels:
      job: nodeExporter
      severity: critical
  - alert: host disk_data_used alert
    annotations:
      disk_data_path: ${DISK_DATA_PATH}
      consignee: ${EMAIL_ADDRESS}
      description: 主机 {{ $labels.instance }} 数据分区使用率为 {{ $value | humanize }}%, 大于
        阈值 80%
      summary: disk_data_used (instance {{ $labels.instance }})
    expr: max((node_filesystem_size_bytes{env="${ENV}",mountpoint="${DISK_DATA_PATH}"}-node_filesystem_free_bytes{env="${ENV}",mountpoint="${DISK_DATA_PATH}"})
      *100/(node_filesystem_avail_bytes{env="${ENV}",mountpoint="${DISK_DATA_PATH}"}+(node_filesystem_size_bytes{env="${ENV}",mountpoint="${DISK_DATA_PATH}"}-node_filesystem_free_bytes{env="${ENV}",mountpoint="${DISK_DATA_PATH}"})))by(instance,env)
      >= 80
    for: 1m
    labels:
      job: nodeExporter
      severity: warning
